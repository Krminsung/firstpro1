# (파일 위치: k8s/api-deployment.yaml)

apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
  labels:
    app: ha-api
spec:
  replicas: 2  # 기획서의 HA 구성을 위해 2대 실행
  selector:
    matchLabels:
      app: ha-api
  template:
    metadata:
      labels:
        app: ha-api
    spec:
      containers:
      - name: api-container
        image: ms9019/ha-pipeline-api:latest  # 젠킨스가 빌드할 이미지
        ports:
        - containerPort: 8000
        # K8s가 Pod의 건강 상태를 체크 (main.py의 /health)
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 15
          periodSeconds: 20
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: api-service  # Ingress가 바라볼 서비스 이름
spec:
  type: ClusterIP
  selector:
    app: ha-api
  ports:
  - port: 8000  # 서비스가 8000 포트를 노출
    targetPort: 8000 # Pod의 8000 포트로 연결